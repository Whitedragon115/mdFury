# å°ˆæ¡ˆ API èˆ‡é é¢è·¯ç”±æ–‡æª”

æœ¬æ–‡æª”è©³ç´°ä»‹ç´¹äº† mdFury å°ˆæ¡ˆä¸­çš„æ‰€æœ‰ API è·¯ç”±å’Œé é¢ï¼Œè§£é‡‹äº†å®ƒå€‘å„è‡ªçš„åŠŸèƒ½å’Œç”¨é€”ã€‚

## ğŸ“‹ é é¢ (Pages)

ä»¥ä¸‹æ˜¯æ‡‰ç”¨ç¨‹å¼ä¸­çš„ä¸»è¦é é¢åŠå…¶åŠŸèƒ½ï¼š

### `src/app/page.tsx`

- **è·¯ç”±:** `/`
- **åŠŸèƒ½:** æ‡‰ç”¨ç¨‹å¼çš„ä¸»è¦é€²å…¥é»ã€‚æ­¤é é¢æ¸²æŸ“æ ¸å¿ƒçš„ `App` å…ƒä»¶ï¼Œå…¶ä¸­åŒ…å«äº† Markdown ç·¨è¼¯å™¨çš„ä¸»ä»‹é¢ã€‚

### `src/app/login/page.tsx`

- **è·¯ç”±:** `/login`
- **åŠŸèƒ½:** æä¾›ä½¿ç”¨è€…ç™»å…¥ä»‹é¢ã€‚æ­¤é é¢æ¸²æŸ“ `LoginForm` å…ƒä»¶ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥è¼¸å…¥å¸³è™Ÿå¯†ç¢¼é€²è¡Œç™»å…¥ã€‚

### `src/app/settings/page.tsx`

- **è·¯ç”±:** `/settings`
- **åŠŸèƒ½:** ä½¿ç”¨è€…è¨­å®šé é¢ã€‚å·²ç™»å…¥çš„ä½¿ç”¨è€…å¯ä»¥åœ¨æ­¤é é¢ä¸­ä¿®æ”¹å€‹äººè³‡æ–™ã€ä¸»é¡Œã€èƒŒæ™¯ç­‰åå¥½è¨­å®šã€‚

### `src/app/docs/page.tsx`

- **è·¯ç”±:** `/docs`
- **åŠŸèƒ½:** ä½¿ç”¨è€…æ–‡ä»¶åˆ—è¡¨é é¢ã€‚æ­¤é é¢æœƒé¡¯ç¤ºå·²ç™»å…¥ä½¿ç”¨è€…æ‰€å„²å­˜çš„æ‰€æœ‰ Markdown æ–‡ä»¶åˆ—è¡¨ã€‚

### `src/app/bin/[id]/page.tsx`

- **è·¯ç”±:** `/bin/:id`
- **åŠŸèƒ½:** é¡¯ç¤ºå–®ä¸€ Markdown æ–‡ä»¶ï¼ˆ"Bin"ï¼‰ã€‚æ­¤é é¢ç”¨æ–¼å…¬é–‹æˆ–ç§å¯†åœ°å±•ç¤ºä¸€å€‹æ–‡ä»¶ã€‚å®ƒæœƒè™•ç†å¯†ç¢¼ä¿è­·é‚è¼¯ï¼Œä¸¦æ ¹æ“šæ¬Šé™ç²å–æ–‡ä»¶å…§å®¹ã€‚åŒ…å«å¯†ç¢¼è¡¨å–® (`PasswordForm`) ç”¨æ–¼è™•ç†å¯†ç¢¼ä¿è­·çš„æ–‡ä»¶ã€‚

### `src/app/bin/[id]/edit/page.tsx`

- **è·¯ç”±:** `/bin/:id/edit`
- **åŠŸèƒ½:** ç·¨è¼¯ Markdown æ–‡ä»¶ã€‚å¦‚æœä½¿ç”¨è€…æ˜¯è©²æ–‡ä»¶çš„æ“æœ‰è€…ï¼Œæ­¤é é¢å°‡å…è¨±ä»–å€‘å°æ–‡ä»¶é€²è¡Œç·¨è¼¯ã€‚

---

## ğŸš€ API è·¯ç”± (API Routes)

ä»¥ä¸‹æ˜¯å°ˆæ¡ˆå¾Œç«¯çš„ API è·¯ç”±åŠå…¶è©³ç´°èªªæ˜ã€‚

### `src/app/api/auth/login/route.ts`

- **è·¯ç”±:** `POST /api/auth/login`
- **åŠŸèƒ½:** ä½¿ç”¨è€…ç™»å…¥ã€‚
- **è«‹æ±‚ Body:**
  ```json
  {
    "username": "your-username",
    "password": "your-password"
  }
  ```
- **æˆåŠŸå›æ‡‰ (200):**
  ```json
  {
    "success": true,
    "token": "jwt-token",
    "user": { ... }
  }
  ```
- **å¤±æ•—å›æ‡‰ (401):**
  ```json
  {
    "success": false,
    "message": "Invalid credentials"
  }
  ```

### `src/app/api/auth/verify/route.ts`

- **è·¯ç”±:** `GET /api/auth/verify`
- **åŠŸèƒ½:** é©—è­‰ä½¿ç”¨è€…çš„ JWTã€‚
- **è«‹æ±‚ Headers:**
  ```
  Authorization: Bearer your-jwt-token
  ```
- **æˆåŠŸå›æ‡‰ (200):**
  ```json
  {
    "success": true,
    "user": { ... }
  }
  ```
- **å¤±æ•—å›æ‡‰ (401):**
  ```json
  {
    "success": false,
    "message": "Invalid token"
  }
  ```

### `src/app/api/auth/profile/route.ts`

- **è·¯ç”±:** `PUT /api/auth/profile`
- **åŠŸèƒ½:** æ›´æ–°å·²ç™»å…¥ä½¿ç”¨è€…çš„å€‹äººè³‡æ–™ã€‚
- **è«‹æ±‚ Headers:**
  ```
  Authorization: Bearer your-jwt-token
  ```
- **è«‹æ±‚ Body:** åŒ…å«è¦æ›´æ–°çš„æ¬„ä½ï¼Œä¾‹å¦‚ï¼š
  ```json
  {
    "displayName": "New Name",
    "theme": "dark"
  }
  ```
- **æˆåŠŸå›æ‡‰ (200):**
  ```json
  {
    "success": true,
    "user": { ... } // æ›´æ–°å¾Œçš„ä½¿ç”¨è€…è³‡æ–™
  }
  ```

### `src/app/api/auth/profile/[userId]/route.ts`

- **è·¯ç”±:** `GET /api/auth/profile/:userId`
- **åŠŸèƒ½:** ç²å–æŒ‡å®šä½¿ç”¨è€…çš„å…¬é–‹å€‹äººè³‡æ–™ã€‚
- **æˆåŠŸå›æ‡‰ (200):**
  ```json
  {
    "success": true,
    "user": {
      "id": "user-id",
      "username": "username",
      "displayName": "Display Name",
      // ... å…¶ä»–å…¬é–‹æ¬„ä½
    }
  }
  ```
- **å¤±æ•—å›æ‡‰ (404):**
  ```json
  {
    "success": false,
    "message": "User not found"
  }
  ```

### `src/app/api/markdowns/route.ts`

- **è·¯ç”±:** `GET /api/markdowns`
- **åŠŸèƒ½:** ç²å–å·²ç™»å…¥ä½¿ç”¨è€…çš„æ‰€æœ‰ Markdown æ–‡ä»¶ã€‚
- **è«‹æ±‚ Headers:**
  ```
  Authorization: Bearer your-jwt-token
  ```
- **æˆåŠŸå›æ‡‰ (200):**
  ```json
  {
    "success": true,
    "markdowns": [ ... ] // æ–‡ä»¶åˆ—è¡¨
  }
  ```

- **è·¯ç”±:** `POST /api/markdowns`
- **åŠŸèƒ½:** å»ºç«‹ä¸€å€‹æ–°çš„ Markdown æ–‡ä»¶ã€‚
- **è«‹æ±‚ Headers:**
  ```
  Authorization: Bearer your-jwt-token
  ```
- **è«‹æ±‚ Body:**
  ```json
  {
    "title": "New Document",
    "content": "# Hello World"
  }
  ```
- **æˆåŠŸå›æ‡‰ (200):**
  ```json
  {
    "success": true,
    "markdown": { ... } // æ–°å»ºç«‹çš„æ–‡ä»¶è³‡æ–™
  }
  ```

### `src/app/api/public/[binId]/route.ts`

- **è·¯ç”±:** `GET /api/public/:binId`
- **åŠŸèƒ½:** ç²å–ä¸€å€‹å…¬é–‹çš„ Markdown æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶æœ‰å¯†ç¢¼ï¼Œéœ€è¦åœ¨æŸ¥è©¢åƒæ•¸ä¸­æä¾›ã€‚
- **æŸ¥è©¢åƒæ•¸:** `?password=your-password` (å¦‚æœéœ€è¦)
- **æˆåŠŸå›æ‡‰ (200):**
  ```json
  {
    "success": true,
    "markdown": { ... }
  }
  ```
- **å¤±æ•—å›æ‡‰ (404):** æ–‡ä»¶æœªæ‰¾åˆ°ã€‚
- **å¤±æ•—å›æ‡‰ (423):** éœ€è¦å¯†ç¢¼ (Locked)ã€‚
- **å¤±æ•—å›æ‡‰ (403):** å¯†ç¢¼éŒ¯èª¤æˆ–ç„¡æ¬Šé™ (Access Denied)ã€‚

---

## ğŸ”’ å®‰å…¨æ€§èˆ‡æ¬Šé™é‚è¼¯

### å¯†ç¢¼ä¿è­·èˆ‡ç§äººæ–‡ä»¶é™åˆ¶

å°ˆæ¡ˆå¯¦ä½œäº†ä»¥ä¸‹å®‰å…¨é‚è¼¯ï¼š

1. **å¯†ç¢¼ä¿è­·çš„æ–‡ä»¶å¿…é ˆæ˜¯å…¬é–‹çš„**: å¦‚æœä¸€å€‹æ–‡ä»¶è¨­å®šäº†å¯†ç¢¼ä¿è­·ï¼Œå®ƒä¸èƒ½åŒæ™‚è¨­å®šç‚ºç§äººæ–‡ä»¶ã€‚é€™å€‹é‚è¼¯åœ¨ä»¥ä¸‹åœ°æ–¹å¯¦ä½œï¼š
   - å‰ç«¯ UIï¼šç•¶å•Ÿç”¨å¯†ç¢¼ä¿è­·æ™‚ï¼Œæœƒè‡ªå‹•å°‡æ–‡ä»¶è¨­å®šç‚ºå…¬é–‹ï¼Œä¸¦é˜»æ­¢ä½¿ç”¨è€…å°‡å…¶è¨­å®šç‚ºç§äºº
   - å¾Œç«¯ APIï¼šåœ¨å„²å­˜å’Œæ›´æ–°æ–‡ä»¶æ™‚æœƒé©—è­‰é€™å€‹é‚è¼¯
   - è³‡æ–™åº«å±¤ï¼šç¢ºä¿è³‡æ–™ä¸€è‡´æ€§

2. **ç§äººæ–‡ä»¶æ¬Šé™æª¢æŸ¥**: 
   - åªæœ‰æ–‡ä»¶æ“æœ‰è€…å¯ä»¥æŸ¥çœ‹ç§äººæ–‡ä»¶
   - æœªç™»å…¥ä½¿ç”¨è€…å˜—è©¦å­˜å–ç§äººæ–‡ä»¶æ™‚æœƒè¦æ±‚ç™»å…¥
   - å·²ç™»å…¥ä½†éæ“æœ‰è€…çš„ä½¿ç”¨è€…æœƒè¢«æ‹’çµ•å­˜å–

3. **å¯†ç¢¼è¡¨å–®çµ„ä»¶** (`PasswordForm`):
   - æä¾›ç¾è§€çš„å¯†ç¢¼è¼¸å…¥ä»‹é¢
   - æ”¯æ´é¡¯ç¤º/éš±è—å¯†ç¢¼
   - åŒ…å«éŒ¯èª¤è™•ç†å’Œè¼‰å…¥ç‹€æ…‹

---

## ğŸ—‚ï¸ å…ƒä»¶èªªæ˜

### `PasswordForm` å…ƒä»¶

ä½ç½®ï¼š`src/components/PasswordForm.tsx`

æ­¤å…ƒä»¶ç”¨æ–¼è™•ç†å¯†ç¢¼ä¿è­·æ–‡ä»¶çš„å¯†ç¢¼è¼¸å…¥ï¼š

**Props:**
- `title`: è¡¨å–®æ¨™é¡Œ
- `onSubmit`: å¯†ç¢¼æäº¤å›èª¿å‡½æ•¸
- `error`: éŒ¯èª¤è¨Šæ¯
- `isLoading`: è¼‰å…¥ç‹€æ…‹
- `onCancel`: å–æ¶ˆå›èª¿å‡½æ•¸

**åŠŸèƒ½:**
- å¯†ç¢¼é¡¯ç¤º/éš±è—åˆ‡æ›
- è¡¨å–®é©—è­‰
- éŒ¯èª¤é¡¯ç¤º
- éŸ¿æ‡‰å¼è¨­è¨ˆ

---

## ğŸ“ å·²æ£„ç”¨æˆ–é‡å®šå‘çš„è·¯ç”±

- `src/app/[binId]/page.tsx`: æ­¤è·¯ç”±æœƒå°‡èˆŠç‰ˆçš„ `/[binId]` URL é‡å®šå‘åˆ°æ–°çš„ `/bin/[binId]` çµæ§‹ã€‚
- `src/app/[binId]/edit/page.tsx`: æ­¤è·¯ç”±æœƒå°‡èˆŠç‰ˆçš„ `/[binId]/edit` URL é‡å®šå‘åˆ°æ–°çš„ `/bin/[binId]/edit` çµæ§‹ã€‚

